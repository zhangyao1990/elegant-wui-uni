var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,n=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&i(e,a,t[a]);if(l)for(var a of l(t))o.call(t,a)&&i(e,a,t[a]);return e},u=(e,l)=>t(e,a(l));import{d as r,H as c,r as d,I as f,z as h,c as p,v as _,Z as v,e as g,f as m,n as w,g as y,h as b,w as x,a as k,x as C,i as T,B as S,ao as P,A as I,k as j,t as F,u as z,s as W,F as R,ap as H,aq as O,aj as q,p as B}from"./index-CnRAlpd-.js";import{_ as D}from"./wui-button.Bcr_H9ae.js";import{c as $,z as E,f as L,E as N,n as V,e as A,o as G,g as J,p as M,a as U,_ as Z,w as K}from"./page-wraper.DMME2CXH.js";import{u as Q}from"./useTranslate.DCsJG8gA.js";import{_ as X}from"./wui-img.bauLhy_f.js";import{_ as Y}from"./demo-block.BWMqEgaZ.js";const ee=u(n({},$),{penColor:{type:String,default:"#000"},lineWidth:{type:Number,default:3},clearText:String,confirmText:String,fileType:{type:String,default:"png"},quality:{type:Number,default:1},exportScale:{type:Number,default:1},disabled:{type:Boolean,default:!1},height:E,width:E,backgroundColor:String,disableScroll:{type:Boolean,default:!0},showFooter:{type:Boolean,default:!0},isRotate:{type:Boolean,default:!1},promptText:String}),te=U(r(u(n({},{name:"wui-signature",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"}}),{props:ee,emits:["start","end","signing","confirm","clear"],setup(e,{expose:t,emit:a}){const l=L("wui-signature"),s=e,o=a,{translate:i}=Q("signature"),{proxy:n}=c(),u=d(`signature${N()}`);const r=d(!1),B=d(1),$=f({canvasWidth:0,canvasHeight:0,ctx:null});h((()=>s.penColor),(()=>{le()})),h((()=>s.lineWidth),(()=>{le()}));const E=p((()=>{const e={};return V(s.width)&&(e.width=A(s.width)),V(s.height)&&(e.height=A(s.height)),`${G(e)};`})),U=p((()=>s.disableScroll));let Z=[];const K=e=>{e.preventDefault(),r.value=!0,le(),o("start",e),ae(e)},X=e=>{e.preventDefault(),r.value=!1;const{ctx:t}=$;if(t){t.beginPath(),t.draw(!0);const a=e.changedTouches[0],l={x:a.x,y:a.y};Z.unshift({x:l.x,y:l.y,r:0,time:Date.now()})}o("end",e)},Y=()=>{new Promise((e=>{const{ctx:t}=$;if(t)return e(t);setTimeout((()=>{M(`#${u.value}`,!1,n).then((t=>{var a,l;a=t.width,l=t.height,$.canvasHeight=l*B.value,$.canvasWidth=a*B.value,$.ctx=H(u.value,n),$.ctx&&$.ctx.scale(B.value,B.value),e($.ctx)}))}),500)})).then((()=>{const{ctx:e}=$;e&&V(s.backgroundColor)&&(e.fillStyle=s.backgroundColor,e.fillRect(0,0,$.canvasWidth,$.canvasHeight),e.draw(),Z=[])}))},ee=()=>{const{canvasWidth:e,canvasHeight:t,ctx:a}=$;a&&(a.clearRect(0,0,e,t),V(s.backgroundColor)&&(a.fillStyle=s.backgroundColor,a.fillRect(0,0,e,t)),a.draw(),Z=[]),o("clear")},te=()=>{!function(){const{fileType:e,quality:t,exportScale:a}=s,{canvasWidth:r,canvasHeight:c,ctx:d}=$;if(!Z.length||!d)return void l.show({msg:s.promptText||i("promptText")});O({width:r*a,height:c*a,destWidth:r*a,destHeight:c*a,fileType:e,quality:t,canvasId:u.value,canvas:null,success:e=>{if(s.isRotate)t=e.tempFilePath,q({src:t,success:e=>{let t=H("canvasRotateId",n),a=300/(e.height/e.width),l=300;t.translate(l/2,a/2),t.rotate(270*Math.PI/180),t.drawImage(e.path,-a/2,-150,a,l),t.draw(!1,(e=>{O({canvasId:"canvasRotateId",fileType:"png",quality:1,success(e){const t={tempFilePath:e.tempFilePath,width:a*s.exportScale/B.value,height:l*s.exportScale/B.value,success:!0};o("confirm",t)}},n)}))}});else{const t={tempFilePath:e.tempFilePath,width:r*a/B.value,height:c*a/B.value,success:!0};o("confirm",t)}var t},fail:()=>{const e={tempFilePath:"",width:r*a/B.value,height:c*a/B.value,success:!1};o("confirm",e)}},n)}()},ae=e=>{e.preventDefault();const{ctx:t}=$;if(!r.value||s.disabled||!t)return;const{x:a,y:l}=e.touches[0];t.lineTo(a,l),t.stroke(),t.draw(!0),t.moveTo(a,l),o("signing",e)};function le(){const{ctx:e}=$;e&&(e.setLineWidth(s.lineWidth),e.setStrokeStyle(s.penColor),e.setLineJoin("round"),e.setLineCap("round"))}return _((()=>{Y()})),v((()=>{})),t({clear:ee,confirm:te}),(e,t)=>{const a=P,l=T,s=g(m("wui-button"),D);return y(),w(R,null,[b(l,{class:W(`wui-signature ${e.customClass}`)},{default:x((()=>[b(l,{class:"wui-signature__content",style:S(E.value)},{default:x((()=>[b(a,{class:"wui-signature__content-canvas","canvas-id":u.value,width:$.canvasWidth,height:$.canvasHeight,id:u.value,"disable-scroll":U.value,onTouchstart:K,onTouchend:X,onTouchmove:ae},null,8,["canvas-id","width","height","id","disable-scroll"])])),_:1},8,["style"]),e.showFooter?(y(),k(l,{key:0,class:"wui-signature__footer"},{default:x((()=>[I(e.$slots,"footer",{clear:ee,confirm:te},(()=>[b(s,{size:"small",plain:"",onClick:ee},{default:x((()=>[j(F(e.clearText||z(i)("clearText")),1)])),_:1}),b(s,{size:"small",onClick:te},{default:x((()=>[j(F(e.confirmText||z(i)("confirmText")),1)])),_:1})]),!0)])),_:3})):C("",!0),b(J,{selector:"wui-signature"})])),_:3},8,["class"]),b(a,{style:{position:"fixed",left:"9999px",bottom:"9999px"},"canvas-id":"canvasRotateId"})],64)}}})),[["__scopeId","data-v-6f500b56"]]),ae=U(r({__name:"Index",setup(e){const t=d({}),a=d(!0);function l(e){t.value=e}function s(){t.value={}}function o(){a.value=!1}const i=d(!1),n=d(["#080808","#E83A30"]),u=d(n.value[0]);function r(){i.value=!0}const c=d(),f=()=>{c.value.clear()},h=()=>{c.value.confirm()};function p(){i.value=!1,t.value={}}function _(e){console.log("handleSignConfirm",e),i.value=!1,t.value=e}return(e,d)=>{const v=g(m("wui-signature"),te),P=T,I=g(m("wui-img"),X),F=g(m("demo-block"),Y),z=g(m("wui-button"),D),H=g(m("page-wraper"),Z),O=g(m("wui-popup"),K);return y(),w(R,null,[b(H,null,{default:x((()=>[b(F,{title:"基础用法"},{default:x((()=>[b(P,{class:"signature-h"},{default:x((()=>[b(v,{onConfirm:l,onClear:s,"export-scale":2})])),_:1}),t.value.tempFilePath?(y(),k(I,{key:0,style:{"margin-top":"10rpx"},mode:"widthFix",width:"100%",src:t.value.tempFilePath},null,8,["src"])):C("",!0)])),_:1}),b(F,{title:"自定义画笔颜色"},{default:x((()=>[b(P,{class:"signature-h"},{default:x((()=>[b(v,{"pen-color":"red"})])),_:1})])),_:1}),b(F,{title:"自定义画笔宽度"},{default:x((()=>[b(P,{class:"signature-h"},{default:x((()=>[b(v,{"line-width":6})])),_:1})])),_:1}),b(F,{title:"自定义背景颜色"},{default:x((()=>[b(P,{class:"signature-h"},{default:x((()=>[b(v)])),_:1})])),_:1}),b(F,{title:"自定义插槽"},{default:x((()=>[b(P,{class:"signature-h"},{default:x((()=>[b(v,{disabled:a.value,onConfirm:_},{footer:x((({clear:e,confirm:t})=>[a.value?(y(),k(z,{key:0,block:"",onClick:o},{default:x((()=>[j("开始签名")])),_:1})):C("",!0),a.value?C("",!0):(y(),k(z,{key:1,size:"small",plain:"",onClick:e},{default:x((()=>[j("清除")])),_:2},1032,["onClick"])),a.value?C("",!0):(y(),k(z,{key:2,size:"small",style:{"margin-left":"4px"},onClick:t},{default:x((()=>[j("确认")])),_:2},1032,["onClick"]))])),_:1},8,["disabled"])])),_:1})])),_:1}),b(F,{title:"横屏"},{default:x((()=>[b(z,{block:"",onClick:r},{default:x((()=>[j("开始签名")])),_:1})])),_:1})])),_:1}),b(O,{modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=e=>i.value=e),zIndex:9999,"lock-scroll":"","custom-style":"width:100%; height: 100%;",onClose:p},{default:x((()=>[b(P,{class:"wui-sign-board"},{default:x((()=>[b(P,{class:"wui-sign-board__content"},{default:x((()=>[i.value?(y(),k(v,{key:0,ref_key:"signRef",ref:c,showFooter:!1,isRotate:!0,"pen-color":u.value,onConfirm:_,"line-width":6},null,8,["pen-color"])):C("",!0)])),_:1}),b(P,{class:"wui-sign-board__tools"},{default:x((()=>[b(P,{class:"wui-sign-board__tools__color"},{default:x((()=>[(y(!0),w(R,null,B(n.value,((e,t)=>(y(),k(P,{key:t,class:W(["wui-sign-board__tools__color__item",[{"wui-sign-board__tools__color__item--active":u.value===e}]]),style:S({backgroundColor:e}),onClick:t=>{return a=e,void(u.value=a);var a}},null,8,["class","style","onClick"])))),128))])),_:1}),b(P,{class:"wui-sign-board__tools__button"},{default:x((()=>[b(P,{class:"wui-sign-board__tools__button__item"},{default:x((()=>[b(z,{type:"error",size:"small",onClick:f},{default:x((()=>[j("清除")])),_:1})])),_:1}),b(P,{class:"wui-sign-board__tools__button__item"},{default:x((()=>[b(z,{size:"small",onClick:h},{default:x((()=>[j("保存")])),_:1})])),_:1}),b(P,{class:"wui-sign-board__tools__button__item"},{default:x((()=>[b(z,{type:"warning",size:"small",onClick:p},{default:x((()=>[j("关闭")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-0ea20563"]]);export{ae as default};
