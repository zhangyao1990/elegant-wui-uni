var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,u=(l,a,s)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[a]=s,i=(e,l)=>{for(var a in l||(l={}))o.call(l,a)&&u(e,a,l[a]);if(s)for(var a of s(l))t.call(l,a)&&u(e,a,l[a]);return e},r=(e,s)=>l(e,a(s));import{d as n,r as c,c as d,z as m,H as p,v,Z as f,O as g,a as y,g as b,w as _,h,i as k,A as w,x as C,B as V,s as S,n as x,F as O,k as $,t as K,u as j,K as F}from"./index-7V_Oz7o2.js";import{k as I,J as T,m as z,l as P,c as A,N as B,d as D,O as M,Q as q,M as L,n as W,R as H,S as N,b as R,w as E,D as U,a as G}from"./page-wraper.XTDu10FG.js";import{f as J,_ as Q}from"./wui-picker-view.CgUJTY7Q.js";import{u as Z}from"./useTranslate.NU6YixkU.js";const X=r(i({},A),{customLabelClass:P(""),customValueClass:P(""),customViewClass:P(""),label:String,placeholder:String,disabled:I(!1),readonly:I(!1),loading:I(!1),loadingColor:P("#4D80F0"),title:String,cancelButtonText:String,confirmButtonText:String,required:I(!1),size:String,labelWidth:String,useDefaultSlot:I(!1),useLabelSlot:I(!1),error:I(!1),alignRight:I(!1),beforeConfirm:Function,closeOnClickModal:I(!0),safeAreaInsetBottom:I(!0),ellipsis:I(!1),columnsHeight:z(217),valueKey:P("value"),labelKey:P("label"),modelValue:{type:[String,Number,Array],default:""},columns:{type:Array,default:()=>[]},columnChange:Function,displayFormat:Function,zIndex:z(15),prop:String,rules:T(),immediateChange:I(!1),clearable:I(!1)}),Y=G(n(r(i({},{name:"wui-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),{props:X,emits:["confirm","open","cancel","clear","update:modelValue"],setup(e,{expose:l,emit:a}){const{translate:s}=Z("picker"),o=e,t=a,u=c(null),i=B(),r=c(!1),n=c(!1),I=c(""),T=c(""),z=c([]),P=c([]),A=c(!1),G=c(!1),X=d((()=>o.loading||r.value));m((()=>o.displayFormat),(e=>{e&&!U(e)&&console.error("The type of displayFormat must be Function"),u.value&&0!==u.value.getSelectedIndex().length&&se(o.modelValue)}),{immediate:!0,deep:!0}),m((()=>o.modelValue),(e=>{T.value=e,se(e)}),{deep:!0,immediate:!0}),m((()=>o.columns),(e=>{z.value=q(e),P.value=q(e),0===e.length?(T.value=L(o.modelValue)?[]:"",I.value=""):se(o.modelValue)}),{deep:!0,immediate:!0}),m((()=>o.columnChange),(e=>{e&&!U(e)&&console.error("The type of columnChange must be Function")}),{deep:!0,immediate:!0});const{parent:Y}=D(M),ee=d((()=>Y&&o.prop&&Y.errorMessages&&Y.errorMessages[o.prop]?Y.errorMessages[o.prop]:"")),le=d((()=>{let e=!1;if(Y&&Y.props.rules){const l=Y.props.rules;for(const a in l)Object.prototype.hasOwnProperty.call(l,a)&&a===o.prop&&Array.isArray(l[a])&&(e=l[a].some((e=>e.required)))}return o.required||o.rules.some((e=>e.required))||e})),{proxy:ae}=p();function se(e){L(e)&&e.length>0||W(e)&&!L(e)&&""!==e?u.value?g((()=>{ne(u.value.getSelects())})):ne(function(e){const l=J(o.columns,o.valueKey,o.labelKey);if(0===o.columns.length)return;if(""===e||!W(e)||L(e)&&0===e.length)return;const a=H(e);if(-1===["string","number","boolean","array"].indexOf(a))return[];e=L(e)?e:[e],e=e.slice(0,l.length),0===e.length&&(e=l.map((()=>0)));let s=[];e.forEach(((e,a)=>{let t=l[a].findIndex((l=>l[o.valueKey].toString()===e.toString()));t=-1===t?0:t,s.push(t)}));const t=s.map(((e,a)=>l[a][e]));if(1===t.length)return t[0];return t}(e)):I.value=""}function oe(){o.disabled||o.readonly||(t("open"),n.value=!0,T.value=o.modelValue,z.value=P.value)}function te(){n.value=!1,t("cancel");let e=setTimeout((()=>{clearTimeout(e),W(u.value)&&u.value.resetColumns(P.value)}),300)}function ue(){if(X.value)return;if(A.value)return void(G.value=!0);const{beforeConfirm:e}=o;e&&U(e)?e(T.value,(e=>{e&&ie()}),ae.$.exposed):ie()}function ie(){if(X.value||o.disabled)return void(n.value=!1);const e=u.value.getSelects(),l=u.value.getValues(),a=u.value.getColumnsData();n.value=!1,P.value=q(a),t("update:modelValue",l),ne(e),t("confirm",{value:l,selectedItems:e})}function re({value:e}){T.value=e}function ne(e){if(L(e)&&!e.length||!e)return;const{valueKey:l,labelKey:a}=o;I.value=(o.displayFormat||N)(e,{valueKey:l,labelKey:a})}function ce(){}function de(){A.value=!0}function me(){A.value=!1,G.value&&(G.value=!1,ue())}v((()=>{se(o.modelValue)})),f((()=>{z.value=q(o.columns),P.value=q(o.columns)}));const pe=d((()=>o.clearable&&!o.disabled&&!o.readonly&&I.value.length));function ve(){const e=L(T.value)?[]:"";t("update:modelValue",e),t("clear")}const fe=d((()=>!o.disabled&&!o.readonly&&!pe.value));return l({close:function(){te()},open:function(){oe()},setLoading:function(e){r.value=e}}),(e,l)=>{const a=k;return b(),y(a,{class:S(`wui-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""}  ${j(i).border.value?"is-border":""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`),style:V(e.customStyle)},{default:_((()=>[h(a,{class:"wui-picker__field",onClick:oe},{default:_((()=>[e.useDefaultSlot?w(e.$slots,"default",{key:0},void 0,!0):(b(),y(a,{key:1,class:"wui-picker__cell"},{default:_((()=>[e.label||e.useLabelSlot?(b(),y(a,{key:0,class:S(`wui-picker__label ${e.customLabelClass}  ${le.value?"is-required":""}`),style:V(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")},{default:_((()=>[e.label?(b(),x(O,{key:0},[$(K(e.label),1)],64)):w(e.$slots,"label",{key:1},void 0,!0)])),_:3},8,["class","style"])):C("",!0),h(a,{class:"wui-picker__body"},{default:_((()=>[h(a,{class:"wui-picker__value-wraper"},{default:_((()=>[h(a,{class:S(`wui-picker__value ${e.ellipsis&&"is-ellipsis"} ${e.customValueClass} ${I.value?"":"wui-picker__placeholder"}`)},{default:_((()=>[$(K(I.value?I.value:e.placeholder||j(s)("placeholder")),1)])),_:1},8,["class"]),fe.value?(b(),y(R,{key:0,"custom-class":"wui-picker__arrow",name:"arrow-right"})):pe.value?(b(),y(a,{key:1,onClick:F(ve,["stop"])},{default:_((()=>[h(R,{"custom-class":"wui-picker__clear",name:"error-fill"})])),_:1})):C("",!0)])),_:1}),ee.value?(b(),y(a,{key:0,class:"wui-picker__error-message"},{default:_((()=>[$(K(ee.value),1)])),_:1})):C("",!0)])),_:1})])),_:3}))])),_:3}),h(E,{modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=e=>n.value=e),position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"z-index":e.zIndex,"safe-area-inset-bottom":e.safeAreaInsetBottom,onClose:te,"custom-class":"wui-picker__popup"},{default:_((()=>[h(a,{class:"wui-picker__wraper"},{default:_((()=>[h(a,{class:"wui-picker__toolbar",onTouchmove:ce},{default:_((()=>[h(a,{class:"wui-picker__action wui-picker__action--cancel",onClick:te},{default:_((()=>[$(K(e.cancelButtonText||j(s)("cancel")),1)])),_:1}),e.title?(b(),y(a,{key:0,class:"wui-picker__title"},{default:_((()=>[$(K(e.title),1)])),_:1})):C("",!0),h(a,{class:S("wui-picker__action "+(X.value?"is-loading":"")),onClick:ue},{default:_((()=>[$(K(e.confirmButtonText||j(s)("done")),1)])),_:1},8,["class"])])),_:1}),h(Q,{ref_key:"pickerViewWd",ref:u,"custom-class":e.customViewClass,modelValue:T.value,"onUpdate:modelValue":l[0]||(l[0]=e=>T.value=e),columns:z.value,loading:X.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,"immediate-change":e.immediateChange,onChange:re,onPickstart:de,onPickend:me,"column-change":e.columnChange},null,8,["custom-class","modelValue","columns","loading","loading-color","columns-height","value-key","label-key","immediate-change","column-change"])])),_:1})])),_:1},8,["modelValue","close-on-click-modal","z-index","safe-area-inset-bottom"])])),_:3},8,["class","style"])}}})),[["__scopeId","data-v-c991def1"]]);export{Y as _};
