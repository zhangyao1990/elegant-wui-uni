var e=Object.defineProperty,s=Object.defineProperties,o=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(s,o,a)=>o in s?e(s,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[o]=a,u=(e,s)=>{for(var o in s||(s={}))t.call(s,o)&&i(e,o,s[o]);if(a)for(var o of a(s))l.call(s,o)&&i(e,o,s[o]);return e},r=(e,a)=>s(e,o(a));import{d as n,r as c,I as d,a as p,x as f,g as m,w as v,h as _,i as y,K as w,ag as b,B as h,s as g,O as k,c as x,z as C,n as P,F as L,p as D,A as I,j as T,k as F,t as z,D as j,u as K,ah as O,a7 as S,ai as E,aj as U}from"./index-CnRAlpd-.js";import{c as M,a4 as N,b as $,a as A,K as G,n as R,Q as H,a5 as B,a6 as Q,a7 as q,P as J,D as V}from"./page-wraper.DMME2CXH.js";import{u as W}from"./useTranslate.DCsJG8gA.js";import{u as X,a as Y}from"./types.S9j9C-lg.js";const Z=u({},M),ee=A(n(r(u({},{name:"wui-video-preview",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"}}),{props:Z,setup(e,{expose:s}){const o=c(!1),a=d({url:"",poster:"",title:""});function t(){o.value=!1,k((()=>{a.url="",a.poster="",a.title=""}))}return N((()=>o.value)),s({open:function(e){o.value=!0,a.url=e.url,a.poster=e.poster,a.title=e.title},close:t}),(e,s)=>{const l=b,i=y;return o.value?(m(),p(i,{key:0,class:g(`wui-video-preview ${e.customClass}`),style:h(e.customStyle),onClick:t},{default:v((()=>[_(i,{class:"wui-video-preview__video",onClick:s[0]||(s[0]=w((()=>{}),["stop"]))},{default:v((()=>[a.url?(m(),p(l,{key:0,class:"wui-video-preview__video",controls:!0,poster:a.poster,title:a.title,"play-btn-position":"center",enableNative:!0,src:a.url,"enable-progress-gesture":!1},null,8,["poster","title","src"])):f("",!0)])),_:1}),_($,{name:"close","custom-class":"wui-video-preview__close",onClick:t})])),_:1},8,["class","style"])):f("",!0)}}})),[["__scopeId","data-v-d8d740ec"]]),se=A(n(r(u({},{name:"wui-upload",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"}}),{props:X,emits:["fail","change","success","progress","oversize","chooseerror","remove","update:fileList"],setup(e,{expose:s,emit:o}){const a=e,t=o;s({submit:()=>X(),abort:()=>k()});const{translate:l}=W("upload"),i=c([]),n=x((()=>!a.limit||i.value.length<a.limit)),d=c(),{startUpload:w,abort:k,chooseFile:M,UPLOAD_STATUS:N}=Y();function A(){t("update:fileList",i.value)}function X(){const{buildFormData:e,formData:s={},statusKey:o}=a,{action:t,name:l,header:u={},accept:r,successStatus:n,uploadMethod:c}=a,d=R(n)?n:200;for(const a of i.value)a[o]===N.PENDING&&(e?e({file:a,formData:s,resolve:e=>{e&&w(a,{action:t,header:u,name:l,formData:e,fileType:r,statusCode:d,statusKey:o,uploadMethod:c,onSuccess:ae,onError:oe,onProgress:te})}}):w(a,{action:t,header:u,name:l,formData:s,fileType:r,statusCode:d,statusKey:o,uploadMethod:c,onSuccess:ae,onError:oe,onProgress:te}))}function Z(e){return new Promise(((s,o)=>{U({src:e,success:e=>{s(e)},fail:e=>{o(e)}})}))}function se(e,s){const{statusKey:o}=a,t={uid:q.id++,name:e.name||"",thumb:e.thumb||"",[o]:"pending",size:e.size||0,url:e.path,percent:0};"number"==typeof s?i.value.splice(s,1,t):i.value.push(t),a.autoUpload&&X()}function oe(e,s,o){const{statusKey:l}=a,u=i.value.findIndex((e=>e.uid===s.uid));u>-1&&(i.value[u][l]="fail",i.value[u].error=e.message,i.value[u].response=e,t("fail",{error:e,file:s,formData:o}),A())}function ae(e,s,o){const{statusKey:l}=a,u=i.value.findIndex((e=>e.uid===s.uid));u>-1&&(i.value[u][l]="success",i.value[u].response=e.data,t("change",{fileList:i.value}),t("success",{file:s,fileList:i.value,formData:o}),A())}function te(e,s){const o=i.value.findIndex((e=>e.uid===s.uid));o>-1&&(i.value[o].percent=e.progress,t("progress",{response:e,file:s}))}function le(e){const{multiple:s,maxSize:o,accept:l,sizeType:u,limit:r,sourceType:n,compressed:c,maxDuration:d,camera:p,beforeUpload:f,extension:m}=a;M({multiple:s,sizeType:u,sourceType:n,maxCount:r?r-i.value.length:9,accept:l,compressed:c,maxDuration:d,camera:p,extension:m}).then((a=>{let l=a;s||(l=l.slice(0,1));const u=s=>{return a=this,l=null,i=function*(){for(let a=0;a<s.length;a++){const l=s[a];if("image"===l.type&&!l.size){const e=yield Z(l.path);l.size=e.width*e.height}Number(l.size)<=o?se(l,e):t("oversize",{file:l})}},new Promise(((e,s)=>{var o=e=>{try{u(i.next(e))}catch(o){s(o)}},t=e=>{try{u(i.throw(e))}catch(o){s(o)}},u=s=>s.done?e(s.value):Promise.resolve(s.value).then(o,t);u((i=i.apply(a,l)).next())}));var a,l,i};f?f({files:l,fileList:i.value,resolve:e=>{e&&u(l)}}):u(l)})).catch((e=>{t("chooseerror",{error:e})}))}function ie(e){if(a.disabled)return;const{beforeChoose:s}=a;s?s({fileList:i.value,resolve:s=>{s&&le(e)}}):le(e)}function ue(e){i.value.splice(i.value.findIndex((s=>s.uid===e.uid)),1),t("change",{fileList:i.value}),t("remove",{file:e}),A()}function re(e){O({filePath:e.url,showMenu:!0})}function ne(e,s){const{onPreviewFail:o}=a;S({urls:s,current:s[e],fail(){o?o({index:e,imgList:s}):E({title:"预览图片失败",icon:"none"})}})}function ce(e,s){var o;const{onPreviewFail:t}=a;null==(o=d.value)||o.open({url:s[e].url,poster:s[e].thumb,title:s[e].name})}function de(e){const{beforePreview:s,reupload:o}=a,t=H(i.value),l=t.findIndex((s=>s.url===e.url)),u=t.filter((e=>pe(e))),r=u.findIndex((s=>s.url===e.url));o?ie(l):s?s({file:e,index:l,imgList:[],fileList:t,resolve:e=>{e&&ce(r,u)}}):ce(r,u)}function pe(e){return e.name&&B(e.name)||B(e.url)}function fe(e){return e.name&&Q(e.name)||Q(e.url)}return C((()=>a.fileList),(e=>{const{statusKey:s}=a;if(J(e,i.value))return;const o=e.map((e=>(e[s]=e[s]||"success",e.response=e.response||"",r(u({},e),{uid:q.id++}))));i.value=o}),{deep:!0,immediate:!0}),C((()=>a.limit),(e=>{e&&e<i.value.length&&console.error("[elegant-wui-uni]Error: props limit must less than fileList.length")}),{deep:!0,immediate:!0}),C((()=>a.beforePreview),(e=>{e&&!V(e)&&console.error("The type of beforePreview must be Function")}),{deep:!0,immediate:!0}),C((()=>a.onPreviewFail),(e=>{e&&!V(e)&&console.error("The type of onPreviewFail must be Function")}),{deep:!0,immediate:!0}),C((()=>a.beforeRemove),(e=>{e&&!V(e)&&console.error("The type of beforeRemove must be Function")}),{deep:!0,immediate:!0}),C((()=>a.beforeUpload),(e=>{e&&!V(e)&&console.error("The type of beforeUpload must be Function")}),{deep:!0,immediate:!0}),C((()=>a.beforeChoose),(e=>{e&&!V(e)&&console.error("The type of beforeChoose must be Function")}),{deep:!0,immediate:!0}),C((()=>a.buildFormData),(e=>{e&&!V(e)&&console.error("The type of buildFormData must be Function")}),{deep:!0,immediate:!0}),(e,s)=>{const o=T,t=y,u=b,r=j;return m(),P(L,null,[_(t,{class:g(["wui-upload",e.customClass]),style:h(e.customStyle)},{default:v((()=>[(m(!0),P(L,null,D(i.value,((s,n)=>(m(),p(t,{class:g(["wui-upload__preview",e.customPreviewClass]),key:n},{default:v((()=>[_(t,{class:"wui-upload__status-content"},{default:v((()=>[fe(s)?(m(),p(o,{key:0,src:s.url,mode:e.imageMode,class:"wui-upload__picture",onClick:e=>function(e){const{beforePreview:s,reupload:o}=a,t=H(i.value),l=t.findIndex((s=>s.url===e.url)),u=t.filter((e=>fe(e))).map((e=>e.url)),r=u.findIndex((s=>s===e.url));o?ie(l):s?s({file:e,index:l,fileList:t,imgList:u,resolve:e=>{e&&ne(r,u)}}):ne(r,u)}(s)},null,8,["src","mode","onClick"])):pe(s)?(m(),P(L,{key:1},[s.thumb?(m(),p(t,{key:0,class:"wui-upload__video",onClick:e=>de(s)},{default:v((()=>[_(o,{src:s.thumb,mode:e.imageMode,class:"wui-upload__picture"},null,8,["src","mode"]),_($,{name:"play-circle-filled","custom-class":"wui-upload__video-paly"})])),_:2},1032,["onClick"])):(m(),p(t,{key:1,class:"wui-upload__video",onClick:e=>de(s)},{default:v((()=>[_(u,{src:s.url,title:s.name||"视频"+n,"object-fit":"contain",controls:!1,poster:s.thumb,autoplay:!1,"show-center-play-btn":!1,"show-fullscreen-btn":!1,"show-play-btn":!1,"show-loading":!1,"show-progress":!1,"show-mute-btn":!1,"enable-progress-gesture":!1,enableNative:!0,class:"wui-upload__video"},null,8,["src","title","poster"]),_($,{name:"play-circle-filled","custom-class":"wui-upload__video-paly"})])),_:2},1032,["onClick"]))],64)):(m(),p(t,{key:2,class:"wui-upload__file",onClick:e=>function(e){const{beforePreview:s,reupload:o}=a,t=H(i.value),l=t.findIndex((s=>s.url===e.url));o?ie(l):s?s({file:e,index:l,imgList:[],fileList:t,resolve:s=>{s&&re(e)}}):re(e)}(s)},{default:v((()=>[_($,{name:"file","custom-class":"wui-upload__file-icon"}),_(t,{class:"wui-upload__file-name"},{default:v((()=>[F(z(s.name||s.url),1)])),_:2},1024)])),_:2},1032,["onClick"]))])),_:2},1024),"success"!==s[a.statusKey]?(m(),p(t,{key:0,class:"wui-upload__mask wui-upload__status-content"},{default:v((()=>["loading"===s[a.statusKey]?(m(),p(t,{key:0,class:"wui-upload__status-content"},{default:v((()=>[_(G,{type:e.loadingType,size:e.loadingSize,color:e.loadingColor},null,8,["type","size","color"]),_(r,{class:"wui-upload__progress-txt"},{default:v((()=>[F(z(s.percent)+"%",1)])),_:2},1024)])),_:2},1024)):f("",!0),"fail"===s[a.statusKey]?(m(),p(t,{key:1,class:"wui-upload__status-content"},{default:v((()=>[_($,{name:"close-outline","custom-class":"wui-upload__icon"}),_(r,{class:"wui-upload__progress-txt"},{default:v((()=>[F(z(s.error||K(l)("error")),1)])),_:2},1024)])),_:2},1024)):f("",!0)])),_:2},1024)):f("",!0),"loading"===s[a.statusKey]||e.disabled?f("",!0):(m(),p($,{key:1,name:"error-fill","custom-class":"wui-upload__close",onClick:e=>function(e){const{beforeRemove:s}=a,o=e,t=i.value[o];s?s({file:t,index:o,fileList:i.value,resolve:e=>{e&&ue(t)}}):ue(t)}(n)},null,8,["onClick"])),e.$slots["preview-cover"]?I(e.$slots,"preview-cover",{key:2,file:s,index:n},void 0,!0):f("",!0)])),_:2},1032,["class"])))),128)),n.value?(m(),P(L,{key:0},[e.$slots.default?(m(),p(t,{key:0,class:g(["wui-upload__evoke-slot",e.customEvokeClass]),onClick:ie},{default:v((()=>[I(e.$slots,"default",{},void 0,!0)])),_:3},8,["class"])):(m(),p(t,{key:1,onClick:ie,class:g(["wui-upload__evoke",e.disabled?"is-disabled":"",e.customEvokeClass])},{default:v((()=>[_($,{class:"wui-upload__evoke-icon",name:"fill-camera"}),e.limit&&e.showLimitNum?(m(),p(t,{key:0,class:"wui-upload__evoke-num"},{default:v((()=>[F("（"+z(i.value.length)+"/"+z(e.limit)+"）",1)])),_:1})):f("",!0)])),_:1},8,["class"]))],64)):f("",!0)])),_:3},8,["class","style"]),_(ee,{ref_key:"videoPreview",ref:d},null,512)],64)}}})),[["__scopeId","data-v-3db2a103"]]);export{se as _};
